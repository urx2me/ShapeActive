Imports System.Text.RegularExpressions
Imports System.Windows.Forms.VisualStyles.VisualStyleElement
Imports MySql.Data.MySqlClient

Public Class frmLogin
    Public Shared Useremail As String
    Private Sub btnLogin_Click(sender As Object, e As EventArgs) Handles btnLogin.Click
        Dim email As String = txtEmail.Text
        Dim password As String = txtPassword.Text

        If AuthenticateUser(email, password) Then
            ' Successful login, open the main form.
            Useremail = email
            Dim mainForm As New frmMain()
            Me.Hide() ' Hide the current login form.
            mainForm.Show() ' Show the frmMain form.

        Else
            MessageBox.Show("Invalid username or password.")
        End If
    End Sub

    Private Function AuthenticateUser(email As String, password As String) As Boolean
        Dim connectionString As String = "Server=localhost;Database=shapeactive;Uid=root;Pwd=nics1108;"
        Using connection As New MySqlConnection(connectionString)
            Try
                connection.Open()
                Dim query As String = "SELECT demail, dpassword FROM tblUsers WHERE demail = @demail AND dpassword = @dpassword"
                Using command As New MySqlCommand(query, connection)
                    command.Parameters.AddWithValue("@demail", email)
                    command.Parameters.AddWithValue("@dpassword", password)

                    Using reader As MySqlDataReader = command.ExecuteReader()
                        Return reader.Read()
                    End Using
                End Using
            Catch ex As Exception
                MessageBox.Show("Error: " & ex.Message)
                Return False
            End Try
        End Using
    End Function

    Private Sub btnSignup_Click(sender As Object, e As EventArgs) Handles btnSignup.Click
        Me.Hide()
        frmSignup.Show()
    End Sub

    Private Sub txtEmail_TextChanged(sender As Object, e As EventArgs) Handles txtEmail.TextChanged
        txtEmail.MaxLength = 30
    End Sub

    Private Sub txtPassword_TextChanged(sender As Object, e As EventArgs) Handles txtPassword.TextChanged
        txtPassword.MaxLength = 20
        txtPassword.UseSystemPasswordChar = True
    End Sub
End Class